# تخطيط تفصيلي لوحدة الواجهة الخلفية (Backend Layer)

## 1. الهدف العام
تطوير واجهة خلفية قوية وآمنة وقابلة للتوسع لمشروع NeuraSynth Studios، تدعم جميع العمليات الأساسية للمنصة مثل إدارة المستخدمين، المشاريع، المطابقة بالذكاء الاصطناعي، والتعامل مع البيانات.

## 2. المكونات الرئيسية
- نظام المصادقة (Authentication System)
- نماذج المستخدمين الموسعة (Expanded User Models)
- إدارة المشاريع المتقدمة (Advanced Project Management)
- محرك المطابقة العصبي (Neural Matching Engine)
- واجهات برمجة التطبيقات (APIs) للاتصال بالواجهة الأمامية وطبقة الذكاء الاصطناعي.

## 3. بنية المحتوى (Content Structure)
سيتم تنظيم الكود في مجلد `backend/` مع تقسيم منطقي للملفات بناءً على الوظائف (مثل `auth.py`, `user.py`, `project.py`, `matching.py`, `main.py`).

## 4. المخطط التفصيلي لكل مكون

### 4.1. نظام المصادقة (Authentication System)
- **الوصف:** إدارة تسجيل الدخول، التسجيل، وإدارة الجلسات باستخدام JWT.
- **الملفات المتأثرة:** `auth.py`, `main.py`, `expanded_user_models.py`.
- **المهام:**
    - تنفيذ نقطة نهاية `/register` لمعالجة تسجيل المستخدمين الجدد.
    - تنفيذ نقطة نهاية `/login` للتحقق من بيانات الاعتماد وإصدار JWT.
    - إضافة حماية للمسارات باستخدام JWT.
    - تشفير كلمات المرور باستخدام `bcrypt`.
- **واجهات برمجية (APIs) الملائمة للفحص:**
    - `POST /api/v1/auth/register`
    - `POST /api/v1/auth/login`
- **قوائم التحقق:**
    - [ ] هل يتم تشفير كلمات المرور بشكل آمن؟
    - [ ] هل يتم إصدار JWTs بشكل صحيح؟
    - [ ] هل يتم التحقق من صلاحية JWTs للمسارات المحمية؟
    - [ ] هل يتم التعامل مع الأخطاء (مثل المستخدم موجود بالفعل، بيانات اعتماد غير صحيحة) بشكل صحيح؟

### 4.2. نماذج المستخدمين الموسعة (Expanded User Models)
- **الوصف:** تعريف نماذج البيانات للمستخدمين (العملاء، المستقلين، التجار) مع حقول إضافية مثل المهارات، الخبرة، التقييمات.
- **الملفات المتأثرة:** `user.py`, `profile.py`, `expanded_user_models.py`, `neurasynth_models.py`.
- **المهام:**
    - تحديد حقول البيانات لكل نوع مستخدم.
    - ربط نماذج المستخدمين بجدول `profiles` في قاعدة البيانات.
    - إضافة وظائف CRUD (إنشاء، قراءة، تحديث، حذف) للمستخدمين وملفاتهم الشخصية.
- **واجهات برمجية (APIs) الملائمة للفحص:**
    - `GET /api/v1/users/{user_id}`
    - `PUT /api/v1/users/{user_id}/profile`
- **قوائم التحقق:**
    - [ ] هل تم تعريف جميع الحقول المطلوبة للمستخدمين والملفات الشخصية؟
    - [ ] هل تعمل عمليات CRUD بشكل صحيح؟
    - [ ] هل يتم التعامل مع العلاقات بين الجداول بشكل صحيح؟

### 4.3. إدارة المشاريع المتقدمة (Advanced Project Management)
- **الوصف:** إدارة إنشاء المشاريع، تحديثها، البحث عنها، وتخصيصها للمستقلين.
- **الملفات المتأثرة:** `project.py`, `main.py`.
- **المهام:**
    - تنفيذ نقطة نهاية `/projects/create` لإنشاء مشاريع جديدة.
    - تنفيذ نقطة نهاية `/projects/{project_id}` لتحديث واسترجاع المشاريع.
    - إضافة وظائف للبحث والتصفية في المشاريع.
- **واجهات برمجية (APIs) الملائمة للفحص:**
    - `POST /api/v1/projects/create`
    - `GET /api/v1/projects/{project_id}`
    - `GET /api/v1/projects/search`
- **قوائم التحقق:**
    - [ ] هل يتم إنشاء المشاريع وتخزينها بشكل صحيح؟
    - [ ] هل تعمل وظائف البحث والتصفية بشكل فعال؟
    - [ ] هل يتم التعامل مع أذونات الوصول للمشاريع؟

### 4.4. محرك المطابقة العصبي (Neural Matching Engine)
- **الوصف:** دمج منطق المطابقة بالذكاء الاصطناعي مع الواجهة الخلفية لتوفير أفضل التطابقات بين المشاريع والمستقلين.
- **الملفات المتأثرة:** `matching.py`, `matching_engine.py`, `advanced_ai_systems.py`, `main.py`.
- **المهام:**
    - استدعاء وظائف محرك المطابقة من طبقة الذكاء الاصطناعي.
    - تخزين نتائج المطابقة في قاعدة البيانات.
    - توفير نقطة نهاية لاسترجاع التطابقات لمشروع معين.
- **واجهات برمجية (APIs) الملائمة للفحص:**
    - `GET /api/v1/matching/find-matches/{project_id}`
- **قوائم التحقق:**
    - [ ] هل يتم استدعاء محرك المطابقة بشكل صحيح؟
    - [ ] هل يتم تخزين نتائج المطابقة بشكل فعال؟
    - [ ] هل يتم عرض التطابقات ذات الصلة للمستخدمين؟

## 5. تقدير عدد الرموز (Estimated Token Count)
لكل مكون من المكونات المذكورة أعلاه، يتوقع أن يتراوح عدد الرموز (الكود والتعليقات) بين 500 إلى 1500 رمز، مما يجعل الإجمالي لوحدة الواجهة الخلفية حوالي 2000 إلى 6000 رمز.

## 6. ملاحظات إضافية
- سيتم استخدام Flask كإطار عمل للواجهة الخلفية.
- سيتم استخدام PostgreSQL كقاعدة بيانات.
- سيتم التركيز على modularity لسهولة الصيانة والتوسع.


